     1                                  ;;=========================================================================
     2                                  ;; Test printf
     3                                  ;;=========================================================================
     4                                  
     5                                  %macro      multipush 0-*
     6                                  
     7                                              %rep %0
     8                                  
     9                                                  push    %1
    10                                  
    11                                              %rotate 1
    12                                              %endrep
    13                                  
    14                                  %endmacro
    15                                  
    16                                  %macro      invoke 1-*
    17                                  
    18                                          %if %0 > 1
    19                                  
    20                                              mov     rdi, %2
    21                                  
    22                                          %if %0 > 2
    23                                  
    24                                              mov     rsi, %3
    25                                  
    26                                          %if %0 > 3
    27                                  
    28                                              mov     rdx, %4
    29                                  
    30                                          %if %0 > 4
    31                                  
    32                                              mov     rcx, %5
    33                                  
    34                                          %if %0 > 5
    35                                  
    36                                              mov     r8, %6
    37                                  
    38                                          %if %0 > 6
    39                                  
    40                                              mov     r9, %7
    41                                  
    42                                          %if %0 > 7
    43                                  
    44                                              multipush %{-1:8}
    45                                  
    46                                          %endif
    47                                          %endif
    48                                          %endif
    49                                          %endif
    50                                          %endif
    51                                          %endif
    52                                          %endif
    53                                  
    54                                              call    %1
    55                                  
    56                                  %endmacro
    57                                  
    58                                  
    59                                              default rel
    60                                  
    61                                              global  _start
    62                                              extern  printf
    63                                  
    64                                              section .text
    65                                  
    66                                  ;;=========================================================================
    67                                  
    68                                  _start:
    69                                              invoke printf, format1, qword CHAR_TEST, CSTR_TEST, qword DINT_TEST, qword UINT_TEST, qword BINT_TEST, qword OINT_TEST, qword XINT_TEST
    69                              <1> 
    69                              <1>  %if %0 > 1
    69                              <1> 
    69 00000000 48BF-               <1>  mov rdi, %2
    69 00000002 [3800000000000000]  <1>
    69                              <1> 
    69                              <1>  %if %0 > 2
    69                              <1> 
    69 0000000A BE47000000          <1>  mov rsi, %3
    69                              <1> 
    69                              <1>  %if %0 > 3
    69                              <1> 
    69 0000000F 48BA-               <1>  mov rdx, %4
    69 00000011 [0000000000000000]  <1>
    69                              <1> 
    69                              <1>  %if %0 > 4
    69                              <1> 
    69 00000019 48C7C14FDEFFFF      <1>  mov rcx, %5
    69                              <1> 
    69                              <1>  %if %0 > 5
    69                              <1> 
    69 00000020 41B873960300        <1>  mov r8, %6
    69                              <1> 
    69                              <1>  %if %0 > 6
    69                              <1> 
    69 00000026 41B949080000        <1>  mov r9, %7
    69                              <1> 
    69                              <1>  %if %0 > 7
    69                              <1> 
    69                              <1>  multipush %-1:8
    69                              <2> 
    69                              <2>  %rep %0
    69                              <2> 
    69                              <2>  push %1
    69                              <2> 
    69                              <2>  %rotate 1
    69                              <2>  %endrep
    69                              <3> 
    69 0000002C 6800040000          <3>  push %1
    69                              <3> 
    69                              <3>  %rotate 1
    69                              <3> 
    69 00000031 68AA260000          <3>  push %1
    69                              <3> 
    69                              <3>  %rotate 1
    69                              <2> 
    69                              <1> 
    69                              <1>  %endif
    69                              <1>  %endif
    69                              <1>  %endif
    69                              <1>  %endif
    69                              <1>  %endif
    69                              <1>  %endif
    69                              <1>  %endif
    69                              <1> 
    69 00000036 E8(00000000)        <1>  call %1
    69                              <1> 
    70                                  
    71                                              invoke printf, format2, lovestr, qword 3802, qword 100, qword '!', qword 127, meowstr
    71                              <1> 
    71                              <1>  %if %0 > 1
    71                              <1> 
    71 0000003B 48BF-               <1>  mov rdi, %2
    71 0000003D [1800000000000000]  <1>
    71                              <1> 
    71                              <1>  %if %0 > 2
    71                              <1> 
    71 00000045 48BE-               <1>  mov rsi, %3
    71 00000047 [2E00000000000000]  <1>
    71                              <1> 
    71                              <1>  %if %0 > 3
    71                              <1> 
    71 0000004F BADA0E0000          <1>  mov rdx, %4
    71                              <1> 
    71                              <1>  %if %0 > 4
    71                              <1> 
    71 00000054 B964000000          <1>  mov rcx, %5
    71                              <1> 
    71                              <1>  %if %0 > 5
    71                              <1> 
    71 00000059 41B821000000        <1>  mov r8, %6
    71                              <1> 
    71                              <1>  %if %0 > 6
    71                              <1> 
    71 0000005F 41B97F000000        <1>  mov r9, %7
    71                              <1> 
    71                              <1>  %if %0 > 7
    71                              <1> 
    71                              <1>  multipush %-1:8
    71                              <2> 
    71                              <2>  %rep %0
    71                              <2> 
    71                              <2>  push %1
    71                              <2> 
    71                              <2>  %rotate 1
    71                              <2>  %endrep
    71                              <3> 
    71 00000065 68[33000000]        <3>  push %1
    71                              <3> 
    71                              <3>  %rotate 1
    71                              <2> 
    71                              <1> 
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1> 
    71 0000006A E8(00000000)        <1>  call %1
    71                              <1> 
    72                                  
    73 0000006F B83C000000                          mov     rax, 60
    74 00000074 4831FF                              xor     rdi, rdi
    75 00000077 0F05                                syscall
    76                                  
    77                                  ;;-------------------------------------------------------------------------
    78                                  
    79                                              section .data
    80                                  
    81                                  CHAR_TEST   equ 'G'
    82                                  
    83 00000000 2248656C6C6F2C2069-     CSTR_TEST:  db '"Hello, it is a string"', 0
    83 00000009 742069732061207374-
    83 00000012 72696E672200       
    84                                  
    85                                  DINT_TEST   equ -8625
    86                                  UINT_TEST   equ 235123
    87                                  BINT_TEST   equ 2121
    88                                  OINT_TEST   equ 9898
    89                                  XINT_TEST   equ 1024
    90                                  
    91 00000018 492025732025782564-     format2:    db 'I %s %x%d%%%c%b, %s!' , 0xA, 0
    91 00000021 2525256325622C2025-
    91 0000002A 73210A00           
    92 0000002E 6C6F766500              lovestr:    db 'love', 0
    93 00000033 6D656F7700              meowstr:    db 'meow', 0
    94                                  
    95 00000038 5465737420666F726D-     format1:    db "Test formats:", 10
    95 00000041 6174733A0A         
    96 00000046 2525633A2025630909-                 db "%%c: %c", 9,9,9,9,  "(should be 'G')",      10
    96 0000004F 09092873686F756C64-
    96 00000058 20626520274727290A 
    97 00000061 2525733A2025730A                    db "%%s: %s",                                   10
    98 00000069 2525643A2025640909-                 db "%%d: %d", 9,9,9,    "(should be -8625d)",   10
    98 00000072 092873686F756C6420-
    98 0000007B 6265202D3836323564-
    98 00000084 290A               
    99 00000086 2525753A2025750909-                 db "%%u: %u", 9,9,9,    "(should be 235123d)",  10
    99 0000008F 092873686F756C6420-
    99 00000098 626520323335313233-
    99 000000A1 64290A             
   100 000000A4 2525623A2025620909-                 db "%%b: %b", 9,9,      "(should be 2121d)",    10
   100 000000AD 2873686F756C642062-
   100 000000B6 65203231323164290A 
   101 000000BF 25256F3A20256F0909-                 db "%%o: %o", 9,9,9,    "(should be 9898d)",    10
   101 000000C8 092873686F756C6420-
   101 000000D1 626520393839386429-
   101 000000DA 0A                 
   102 000000DB 2525783A2025780909-                 db "%%x: %x", 9,9,9,9,  "(should be 1024d)",    10
   102 000000E4 09092873686F756C64-
   102 000000ED 206265203130323464-
   102 000000F6 290A               
   103 000000F8 446F6E650A00                        db "Done",                                      10, 0
   104                                  
   105                                  ;;=========================================================================
   106                                  
