     1                                  ;;=========================================================================
     2                                  ;; Test printf
     3                                  ;;=========================================================================
     4                                  
     5                                  %macro      multipush 0-*
     6                                  
     7                                              %rep %0
     8                                  
     9                                                  push    %1
    10                                  
    11                                              %rotate 1
    12                                              %endrep
    13                                  
    14                                  %endmacro
    15                                  
    16                                  %macro      invoke 1-*
    17                                  
    18                                          %if %0 > 1
    19                                  
    20                                              mov     rdi, %2
    21                                  
    22                                          %if %0 > 2
    23                                  
    24                                              mov     rsi, %3
    25                                  
    26                                          %if %0 > 3
    27                                  
    28                                              mov     rdx, %4
    29                                  
    30                                          %if %0 > 4
    31                                  
    32                                              mov     rcx, %5
    33                                  
    34                                          %if %0 > 5
    35                                  
    36                                              mov     r8, %6
    37                                  
    38                                          %if %0 > 6
    39                                  
    40                                              mov     r9, %7
    41                                  
    42                                          %if %0 > 7
    43                                  
    44                                              multipush %{-1:8}
    45                                  
    46                                          %endif
    47                                          %endif
    48                                          %endif
    49                                          %endif
    50                                          %endif
    51                                          %endif
    52                                          %endif
    53                                  
    54                                              call    %1
    55                                  
    56                                  %endmacro
    57                                  
    58                                  
    59                                              default rel
    60                                  
    61                                              global  _start
    62                                              extern  printf
    63                                  
    64                                              section .text
    65                                  
    66                                  ;;=========================================================================
    67                                  
    68                                  _start:
    69                                              ;invoke printf, format1, qword CHAR_TEST, CSTR_TEST, qword DINT_TEST, qword UINT_TEST, qword BINT_TEST, qword OINT_TEST, qword XINT_TEST
    70                                  
    71                                              invoke printf, format2, lovestr, qword 3802, qword 10000000, qword '!', qword 127, qword 101, meowstr
    71                              <1> 
    71                              <1>  %if %0 > 1
    71                              <1> 
    71 00000000 48BF-               <1>  mov rdi, %2
    71 00000002 [3700000000000000]  <1>
    71                              <1> 
    71                              <1>  %if %0 > 2
    71                              <1> 
    71 0000000A 48BE-               <1>  mov rsi, %3
    71 0000000C [5000000000000000]  <1>
    71                              <1> 
    71                              <1>  %if %0 > 3
    71                              <1> 
    71 00000014 BADA0E0000          <1>  mov rdx, %4
    71                              <1> 
    71                              <1>  %if %0 > 4
    71                              <1> 
    71 00000019 B980969800          <1>  mov rcx, %5
    71                              <1> 
    71                              <1>  %if %0 > 5
    71                              <1> 
    71 0000001E 41B821000000        <1>  mov r8, %6
    71                              <1> 
    71                              <1>  %if %0 > 6
    71                              <1> 
    71 00000024 41B97F000000        <1>  mov r9, %7
    71                              <1> 
    71                              <1>  %if %0 > 7
    71                              <1> 
    71                              <1>  multipush %-1:8
    71                              <2> 
    71                              <2>  %rep %0
    71                              <2> 
    71                              <2>  push %1
    71                              <2> 
    71                              <2>  %rotate 1
    71                              <2>  %endrep
    71                              <3> 
    71 0000002A 68[55000000]        <3>  push %1
    71                              <3> 
    71                              <3>  %rotate 1
    71                              <3> 
    71 0000002F 6A65                <3>  push %1
    71                              <3> 
    71                              <3>  %rotate 1
    71                              <2> 
    71                              <1> 
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1>  %endif
    71                              <1> 
    71 00000031 E8(00000000)        <1>  call %1
    71                              <1> 
    72                                  
    73                                  
    74                                  ;            invoke printf, frmt, rsp, rsp
    75                                  
    76 00000036 B83C000000                          mov     rax, 60
    77 0000003B 4831FF                              xor     rdi, rdi
    78 0000003E 0F05                                syscall
    79                                  
    80                                  ;;-------------------------------------------------------------------------
    81                                  
    82                                              section .data
    83                                  
    84 00000000 5B67733A33305D203D-     frmt:       db "[gs:30] = %x and [gs:30] = %x", 10, 0
    84 00000009 20257820616E64205B-
    84 00000012 67733A33305D203D20-
    84 0000001B 25780A00           
    85                                  
    86                                  CHAR_TEST   equ 'G'
    87                                  
    88 0000001F 2248656C6C6F2C2069-     CSTR_TEST:  db '"Hello, it is a string"', 0
    88 00000028 742069732061207374-
    88 00000031 72696E672200       
    89                                  
    90                                  DINT_TEST   equ -8625
    91                                  UINT_TEST   equ 235123
    92                                  BINT_TEST   equ 2121
    93                                  OINT_TEST   equ 9898
    94                                  XINT_TEST   equ 1024
    95                                  
    96 00000037 492025732025782564-     format2:    db 'I %s %x%d%%%c%b, %d %s!' , 0xA, 0
    96 00000040 2525256325622C2025-
    96 00000049 64202573210A00     
    97 00000050 6C6F766500              lovestr:    db 'love', 0
    98 00000055 6D656F7700              meowstr:    db 'meow', 0
    99                                  
   100 0000005A 5465737420666F726D-     format1:    db "Test formats:", 10
   100 00000063 6174733A0A         
   101 00000068 2525633A2025630909-                 db "%%c: %c", 9,9,9,9,  "(should be 'G')",      10
   101 00000071 09092873686F756C64-
   101 0000007A 20626520274727290A 
   102 00000083 2525733A2025730A                    db "%%s: %s",                                   10
   103 0000008B 2525643A2025640909-                 db "%%d: %d", 9,9,9,    "(should be -8625d)",   10
   103 00000094 092873686F756C6420-
   103 0000009D 6265202D3836323564-
   103 000000A6 290A               
   104 000000A8 2525753A2025750909-                 db "%%u: %u", 9,9,9,    "(should be 235123d)",  10
   104 000000B1 092873686F756C6420-
   104 000000BA 626520323335313233-
   104 000000C3 64290A             
   105 000000C6 2525623A2025620909-                 db "%%b: %b", 9,9,      "(should be 2121d)",    10
   105 000000CF 2873686F756C642062-
   105 000000D8 65203231323164290A 
   106 000000E1 25256F3A20256F0909-                 db "%%o: %o", 9,9,9,    "(should be 9898d)",    10
   106 000000EA 092873686F756C6420-
   106 000000F3 626520393839386429-
   106 000000FC 0A                 
   107 000000FD 2525783A2025780909-                 db "%%x: %x", 9,9,9,9,  "(should be 1024d)",    10
   107 00000106 09092873686F756C64-
   107 0000010F 206265203130323464-
   107 00000118 290A               
   108 0000011A 446F6E650A00                        db "Done",                                      10, 0
   109                                  
   110                                  ;;=========================================================================
   111                                  
