     1                                  ;;=========================================================================
     2                                  ;; put_d.asm                                            Shishqa, MIPT 2020
     3                                  ;;=========================================================================
     4                                  
     5                                              global  _put_d
     6                                  
     7                                              extern  _put_u_base
     8                                              extern  _put_c
     9                                  
    10                                              section .text
    11                                  
    12                                  ;;=========================================================================
    13                                  ;; Writes signed int in decimal representation to the console
    14                                  ;;
    15                                  ;; ENTRY: ESI <- int number to print
    16                                  ;; DESTR: RAX RBX RDX RSI RDI ; DF
    17                                  ;;=========================================================================
    18                                  
    19                                  _put_d:
    20 00000000 BA00000080                          mov     edx, 0x80000000         ; EDX = highest bit mask
    21                                  
    22 00000005 21F2                                and     edx, esi
    23 00000007 83FA00                              cmp     edx, 0                  ; if the highest bit is 0,
    24 0000000A 740C                                je      .positive               ; the number is positive
    25                                  
    26                                  .negative:                                  ; else, the number is negative
    27                                  
    28 0000000C 56                                  push    rsi                     ; save RSI
    29                                  
    30 0000000D 40B62D                              mov     sil, '-'
    31 00000010 E8(00000000)                        call    _put_c                  ; print '-'
    32                                  
    33 00000015 5E                                  pop     rsi                     ; restore RSI
    34 00000016 F7DE                                neg     esi                     ; ESI = -ESI
    35                                  
    36                                  .positive:
    37                                  
    38 00000018 66BA0A00                            mov     dx, (0 << 8) | 10       ; DL = 10, DH = 0
    39 0000001C E8(00000000)                        call    _put_u_base
    40                                  
    41 00000021 C3                                  ret
    42                                  
    43                                  ;;=========================================================================
    44                                  
    45                                  
    46                                  
    47                                  
    48                                  
    49                                  
    50                                  
    51                                  
    52                                  
    53                                  
