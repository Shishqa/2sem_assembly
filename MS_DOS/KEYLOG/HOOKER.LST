Turbo Assembler	 Version 4.1	    03/03/20 15:40:49	    Page 1
hooker.asm



      1
      2				     locals @@
      3
      4				     .186
      5	0000			     .model tiny
      6
      7	0000			     .code
      8
      9				     public HookInt
     10				     public OldIntAddr
     11
     12				     ;==========================================================================
     13				     ; System interrupt	hooker
     14				     ; Entry: BX - number of interrupt
     15				     ;	      CS:SI - address of new interrupt handler
     16				     ; Destr: AX BX DI
     17				     ;==========================================================================
     18
     19	0000			     HookInt	     proc
     20
     21	0000  D1 E3				     shl     bx, 1
     22	0002  8B FB				     mov     di, bx
     23	0004  D1 E3				     shl     bx, 1		     ; bx *= 2
     24
     25	0006  33 C0				     xor     ax, ax
     26	0008  8E C0				     mov     es, ax		     ; es = 0
     27
     28	000A  FA				     cli			     ; lock interrupts
     29
     30	000B  26: 8B 07				     mov     ax, word ptr es:[bx]
     31	000E  2E: 89 85	0025r			     mov     cs: OldIntAddr + di, ax
     32	0013  26: 8B 47	02			     mov     ax, word ptr es:[bx+2]
     33	0017  2E: 89 85	0027r			     mov     cs: OldIntAddr + di + 2, ax
     34
     35	001C  26: 89 37				     mov     word ptr es:[bx],	 si  ; setting new interrupt
     36	001F  26: 8C 4F	02			     mov     word ptr es:[bx+2], cs  ; handler address
     37
     38	0023  FB				     sti			     ; unlock interrupts
     39
     40	0024  C3				     ret
     41	0025					     endp
     42
     43				     ; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
     44
     45	0025  80*(0000 0000)	     OldIntAddr	     dw	128 dup(0, 0)
     46
     47				     ;==========================================================================
     48
     49				     end
Turbo Assembler	 Version 4.1	    03/03/20 15:40:49	    Page 2
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "03/03/20"
??FILENAME			  Text	 "hooker  "
??TIME				  Text	 "15:40:49"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0103H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 HOOKER
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
HOOKINT				  Near	 DGROUP:0000
OLDINTADDR			  Word	 DGROUP:0025

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  0225 Word	  Public  CODE
